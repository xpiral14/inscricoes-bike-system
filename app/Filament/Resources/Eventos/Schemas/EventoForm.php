<?php

namespace App\Filament\Resources\Eventos\Schemas;

use Filament\Forms\Components\RichEditor;
use Filament\Forms\Components\Select;
use Filament\Forms\Components\Textarea;
use Filament\Forms\Components\TextInput;
use Filament\Forms\Components\Toggle;
use Filament\Forms\Components\Repeater;

// üëà Adicionado o Repeater
use Filament\Forms\Components\Group;

// üëà Adicionado o Group
use Filament\Schemas\Components\Section;
use Filament\Schemas\Schema;

class EventoForm
{
    public static function configure(Schema $schema): Schema
    {
        return $schema->components([

                                       // --- 1. SE√á√ÉO: INFORMA√á√ïES B√ÅSICAS ---
                                       Section::make('Informa√ß√µes B√°sicas')
                                           ->description('T√≠tulo, Organizador e M√≠dia principal.')
                                           ->collapsible()
                                           ->columns(2)
                                           ->schema([
                                                        TextInput::make('titulo')
                                                            ->label('T√≠tulo')
                                                            ->required()
                                                            ->maxLength(80)
                                                            ->columnSpanFull(),

                                                        Select::make('organizador')
                                                            ->label('Organizador')
                                                            ->relationship('organizadorModel', 'nome')
                                                            ->searchable()
                                                            ->required(),

                                                        Select::make('estruturas')
                                                            ->label('Estruturas')
                                                            ->multiple()
                                                            ->relationship('estruturas', 'name')
                                                            ->preload()
                                                        ,

                                                        TextInput::make('videoyoutube')
                                                            ->label('C√≥digo V√≠deo Youtube')
                                                            ->maxLength(150)
                                                            ->default('_'),
                                                    ]),

                                       // --- 2. SE√á√ÉO: DATAS E LOG√çSTICA ---
                                       Section::make('Datas e Log√≠stica')
                                           ->description('Hor√°rios do evento e op√ß√µes log√≠sticas.')
                                           ->collapsible()
                                           ->columns(3)
                                           ->schema([
                                                        TextInput::make('localevento')
                                                            ->label('Concentra√ß√£o'),
                                                        TextInput::make('limiteinscritos')
                                                            ->label('Limite de inscri√ß√µes pagas')
                                                            ->numeric()
                                                            ->minValue(1)
                                                            ->required()
                                                        ,
                                                        TextInput::make('horaevento')
                                                            ->label('Hora Inicial; Ex: 7:00')
                                                            ->placeholder('HH:MM')
                                                            ->mask('99:99')
                                                            ->maxLength(5),

                                                        TextInput::make('horafinalprovavel')
                                                            ->label('Hora Final provavel (Oculto, Google); Ex: 14:00')
                                                            ->placeholder('HH:MM')
                                                            ->mask('99:99')
                                                            ->maxLength(5),

                                                        TextInput::make('horafinal')
                                                            ->label('Hora Final (Vis√≠vel site); Ex: 14:00')
                                                            ->placeholder('HH:MM')
                                                            ->mask('99:99')
                                                            ->maxLength(5),

                                                        Select::make('exportarendereco')
                                                            ->label('Exportar Endere√ßo')
                                                            ->options([
                                                                          0 => 'N√£o',
                                                                          1 => 'Sim',
                                                                      ])
                                                            ->default(0),

                                                        Select::make('escolhercamisas')
                                                            ->label('Escolher Camisas?')
                                                            ->required()
                                                            ->options([
                                                                          0 => 'N√£o',
                                                                          1 => 'Sim',
                                                                      ])
                                                            ->default(0),

                                                        Select::make('importarFiliados')
                                                            ->label('Import Filiados? (Criar 1¬∫ Cupom Antes)')
                                                            ->options([
                                                                          0 => 'N√£o',
                                                                          1 => 'Sim',
                                                                      ])
                                                            ->default(0),
                                                        Select::make('kit')
                                                            ->label('Possui Kit?')
                                                            ->boolean('Sim', 'N√£o')
                                                    ]),

                                       // --- 3. SE√á√ÉO: CONFIGURA√á√ïES DE VALORES ---
                                       Section::make('Configura√ß√µes de Valores e Taxas')
                                           ->description('Valores de seguro, frete e visibilidade.')
                                           ->collapsible()
                                           ->columns(3)
                                           ->schema([
                                                        // Configura√ß√£o de Seguro
                                                        Select::make('seguro')
                                                            ->label('Seguro?')
                                                            ->options([
                                                                          0 => 'Sem Seguro',
                                                                          1 => 'Obrigat√≥rio',
                                                                          2 => 'Opcional',
                                                                      ])
                                                            ->default(0),

                                                        TextInput::make('vlrSeguro')
                                                            ->label('Vlr Seguro')
                                                            ->prefix('R$')
                                                            ->currencyMask('.', ',')
                                                            ->default('0,00'),

                                                        TextInput::make('custoseguro')
                                                            ->label('Valor Seguro Unit√°rio') // Mudei a ordem para agrupar seguro
                                                            ->required()
                                                            ->prefix('R$')
                                                            ->currencyMask('.', ',')
                                                            ->default('0,00'),

                                                        // Configura√ß√£o de Frete
                                                        TextInput::make('valorfrete')
                                                            ->label('Valor Frete')
                                                            ->prefix('R$')
                                                            ->currencyMask('.', ',')
                                                            ->default('0,00'),

                                                        // Outras op√ß√µes de valor
                                                        Select::make('ocultarValorCategorias')
                                                            ->label('Ocultar Valor Cat?')
                                                            ->options([
                                                                          0 => 'N√£o',
                                                                          1 => 'Sim',
                                                                      ])
                                                            ->default(0),
                                                    ]),

                                       // --- 4. SE√á√ÉO: COMISS√ïES E TAXAS ADICIONAIS ---
                                       Section::make('Comiss√µes e Taxas')
                                           ->description('Defina comiss√µes para diferentes situa√ß√µes e taxas de conv√™nio.')
                                           ->collapsed() // Colapsada por padr√£o para simplificar a vis√£o inicial
                                           ->columns(4) // Usando 4 colunas para organizar melhor os campos de comiss√£o
                                           ->schema([
                                                        // Taxa de Conv√™nio
                                                        Select::make('taxaconv')
                                                            ->label('Tx Conv?')
                                                            ->options([
                                                                          0 => 'Sem Taxa',
                                                                          1 => 'Com Taxa',
                                                                      ])
                                                            ->default(0),

                                                        TextInput::make('vlrTaxaConv')
                                                            ->label('Vlr Tx Conv.')
                                                            ->prefix('R$')
                                                            ->currencyMask('.', ',')
                                                            ->default('0,00'),

                                                        // Toggle de Desconto (columnSpanFull para alinhar)
                                                        Toggle::make('descontartaxasdoliquido')
                                                            ->label('Descontar Taxas do L√≠quido?')
                                                            ->default(true)
                                                            ->columnSpanFull(),

                                                        // Comiss√µes (todos requeridos no seu c√≥digo original)
                                                        TextInput::make('comissaopagos')
                                                            ->label('Comiss. Pagos')
                                                            ->required()
                                                            ->prefix('R$')
                                                            ->currencyMask('.', ',')
                                                            ->default('0,00'),

                                                        TextInput::make('comissaomarcados')
                                                            ->label('Comiss. Marcados Pag')
                                                            ->required()
                                                            ->prefix('R$')
                                                            ->currencyMask('.', ',')
                                                            ->default('0,00'),

                                                        TextInput::make('comissaocortesia')
                                                            ->label('Comiss. Cortesia')
                                                            ->required()
                                                            ->prefix('R$')
                                                            ->currencyMask('.', ',')
                                                            ->default('0,00'),

                                                        TextInput::make('comissaoreembolsoorg')
                                                            ->label('Comiss. Reembolso Organiz')
                                                            ->required()
                                                            ->prefix('R$')
                                                            ->currencyMask('.', ',')
                                                            ->default('0,00'),

                                                        TextInput::make('comissaotransferidoevento')
                                                            ->label('Comiss. Transf. out evt')
                                                            ->required()
                                                            ->prefix('R$')
                                                            ->currencyMask('.', ',')
                                                            ->default('0,00'),

                                                        TextInput::make('comissaodivulgador')
                                                            ->label('Comiss. Divulgador')
                                                            ->prefix('R$')
                                                            ->currencyMask('.', ',')
                                                            ->default('0,00'),
                                                    ]),

                                       // --- 5. SE√á√ÉO: DETALHES E CONTE√öDO ---
                                       Section::make('Detalhes e Conte√∫do')
                                           ->description('Descri√ß√µes longas, m√≠dias visuais')
                                           ->collapsible()
                                           ->schema([
                                                        RichEditor::make('descricao')
                                                            ->columnSpanFull()
                                                            ->toolbarButtons([
                                                                                 'attachFiles', 'blockquote', 'bold', 'bulletList', 'codeBlock', 'h2', 'h3', 'italic',
                                                                                 'link', 'orderedList', 'redo', 'strike', 'underline', 'undo',
                                                                             ]),

                                                        Textarea::make('infopagamento')
                                                            ->label('Info Pagamento para dep√≥sito')
                                                            ->rows(3)
                                                            ->columnSpanFull(),

                                                        Textarea::make('mapa')
                                                            ->label('Mapa')
                                                            ->rows(5)
                                                            ->columnSpanFull(),
                                                    ]),

                                       Section::make('Categorias')
                                           ->description('Categorias do evento.')
                                           ->collapsible()
                                           ->schema([
                                                        Repeater::make('categorias')
                                                            ->label('Categorias do Evento')
                                                            ->relationship('categorias') // Assumindo que voc√™ tem um relacionamento 'categorias' no seu modelo Evento
                                                            ->schema([
                                                                         \Filament\Schemas\Components\Group::make()
                                                                             ->columns(4)
                                                                             ->schema([
                                                                                          TextInput::make('name')
                                                                                              ->label('Nome da Categoria')
                                                                                              ->required()
                                                                                              ->maxLength(145),

                                                                                          TextInput::make('price')
                                                                                              ->label('Pre√ßo')
                                                                                              ->required()
                                                                                              ->currencyMask('.', ',')
                                                                                              ->numeric()
                                                                                              ->prefix('R$')
                                                                                              ->default(0),

                                                                                          TextInput::make('anoInicial')
                                                                                              ->label('Ano Nasc. Inicial')
                                                                                              ->numeric()
                                                                                              ->minValue(1900)
                                                                                              ->maxValue(2099)
                                                                                              ->required()
                                                                                              ->default(1949),

                                                                                          TextInput::make('anoFinal')
                                                                                              ->label('Ano Nasc. Final')
                                                                                              ->numeric()
                                                                                              ->minValue(1900)
                                                                                              ->maxValue(2099)
                                                                                              ->required()
                                                                                              ->default(2013),
                                                                                      ]),

                                                                         Textarea::make('description')
                                                                             ->label('Descri√ß√£o da Categoria')
                                                                             ->rows(2),

                                                                         Toggle::make('permitirDupla')
                                                                             ->label('Permitir Dupla?')
                                                                             ->inline()
                                                                             ->default(false),
                                                                         Toggle::make('ativo')
                                                                             ->label('Ativo?')
                                                                             ->default(true)
                                                                             ->inline(false),

                                                                     ])
                                                            ->defaultItems(1)
                                                            ->createItemButtonLabel('Adicionar Categoria')
                                                            ->columns(1)
                                                            ->columnSpanFull()
                                                    ])
                                   ])->columns(1);
    }
}

# Conteúdo do arquivo nginx.conf (na raiz do seu repositório)

server {
    # 1. Porta de Escuta
    # Precisa ser 3540 (ou a porta interna padrão do Nixpacks, se diferente)
    listen 3540;
    listen [::]:3540;

    # 2. Raiz do Documento
    # Laravel usa a pasta 'public' como a raiz web.
    root /app/public; # O Nixpacks costuma colocar a aplicação em /app.

    server_name _;
    index index.php index.html;
    charset utf-8;

    # 3. Roteamento Laravel (Tratamento para a location principal "/")
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    # 4. Tratamento de Arquivos PHP (PHP-FPM)
    location ~ \.php$ {
        try_files $uri =404;

        # O Nixpacks tipicamente executa o PHP-FPM em uma porta ou socket interno.
        # A porta 9000 é um palpite seguro para o PHP-FPM.
        fastcgi_pass 127.0.0.1:9000;

        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $fastcgi_path_info;
    }

    # 5. Prevenção de Acesso Direto
    location ~ /\. {
        deny all;
    }
}
